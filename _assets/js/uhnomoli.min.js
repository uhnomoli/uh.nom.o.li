!function(a){function e(a){var e=Math.round(.9*b.width()),f=Math.round(.9*b.height()),g=a.width,h=a.height,i=g/h,j=h/g;g>e&&(g=e,h=Math.round(e*j)),h>f&&(g=Math.round(f*i),h=f),a.width=g,a.height=h,d.html(a);var k=d.find("img").first(),l=Math.round(k.outerHeight()/2),m=Math.round(k.outerWidth()/2);k.css({position:"absolute",top:"50%",left:"50%","margin-top":"-"+l.toString()+"px","margin-left":"-"+m.toString()+"px"}),d.fadeIn(),c.on("keyup.litebox",function(a){27==a.keyCode&&(c.off("keyup.litebox"),d.fadeOut())})}function f(){var b=9;a(".words img, div.code").each(function(){var c=a(this),d=c,e=c.parent("a"),f=parseInt(c.css("margin-top"),10),g=parseInt(c.css("margin-bottom"),10),h=c.outerHeight(),i=h%b;if(e.length&&(g+=1,e.css("border-bottom-width","0px"),d.css("margin-bottom",g)),i){var j=c.parents("figure"),k=b-i;j.length&&(d=j),d.css("margin-top",f+Math.ceil(k/2)),d.css("margin-bottom",g+Math.floor(k/2))}})}function h(a,b){return a.filter(b).add(a.find(b))}function i(b){return a(a.parseHTML(b,document,!0))}function j(b){var c=/<head[^>]*>([\s\S]+)<\/head>/.exec(b),d=/<body[^>]*>([\s\S]+)<\/body>/.exec(b),e=c?i(c[1]):a(),f=d?i(d[1]):a(),g=a.trim(h(e,"title").last().html()),j=a.trim(h(f,"#content").first().html());return{title:g,$content:j}}var b=a(window),c=a(document),d=a('<div id="litebox"/>');if(d.on("click.litebox",function(a){a.target==this&&(c.off("keyup.litebox"),d.fadeOut())}),a.fn.litebox=function(){return a("#litebox").length||a("body").prepend(d),this.each(function(){var b=a(this);b.on("click.litebox",function(c){return 2==c.which||c.ctrlKey||c.metaKey?!0:(c.preventDefault(),a("<img>").on("load",function(){e(this)}).attr("src",b.attr("href")),void 0)})})},b.on("load",function(){f()}),!History.enabled)return!1;var g=History.getRootUrl();a.expr.filters.internal=function(a){return a.hostname==window.location.hostname&&/(\/|\.html)$/i.test(a.pathname)&&!a.hash||!1},c.ready(function(){c.on("click","a:internal",function(b){return 2==b.which||b.ctrlKey||b.metaKey?!0:(b.preventDefault(),History.pushState(null,null,a(this).attr("href")),void 0)}),a("a:has(img)").litebox()}),b.on("statechange",function(){var b=History.getState().url,c=b.replace(g,"/");a.get(c).done(function(c){var d=j(c);return d.$content.length?(d.title.length&&a("title").last().html(d.title),a("#litebox").trigger("click.litebox").end().promise().done(function(){var b=a("#content");b.slideUp(500).promise().done(function(){b.html(d.$content).slideDown(500).promise().done(function(){f(),b.find("a:has(img)").litebox()})})}),void 0):(document.location.href=b,!1)}).fail(function(){return document.location.href=b,!1})})}(jQuery);
